!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery||window.Zepto)}(function(e){"use strict";var n,i=[],t={},a=/^([a-z]:)?\/\//i,d=/\.\w+$/;t.init=function(s){return s=e.extend({ping:null,dimensions:"preserve",glue:"_",skipExtensions:["svg"]},s),this.each(function(){var o=e(this);if(o.is("img")&&!o.hasClass("dense-image")){o.addClass("dense-image dense-loading");var r,u=t.getImageAttribute.call(this),c=o.attr("src"),f=!1;if(!u){if(!c||1===n||-1!==e.inArray(c.split(".").pop().split(/[\?\#]/).shift(),s.skipExtensions))return void o.removeClass("dense-image dense-loading");u=c.replace(d,function(e){var i=o.attr("data-dense-cap")?o.attr("data-dense-cap"):n;return s.glue+i+"x"+e}),f=!1!==s.ping&&-1===e.inArray(u,i)&&(!0===s.ping||!a.test(u)||0===u.indexOf("//"+document.domain)||0===u.indexOf(document.location.protocol+"//"+document.domain))}r=function(){var e=function(){o.removeClass("dense-loading").addClass("dense-ready").trigger("denseRetinaReady.dense")};o.attr("src",u),"update"===s.dimensions?o.dense("updateDimensions").one("denseDimensionChanged",e):("remove"===s.dimensions&&o.removeAttr("width height"),e())},f?e.ajax({url:u,type:"HEAD"}).done(function(e,n,t){var a=t.getResponseHeader("Content-type");a&&0!==a.indexOf("image/")||(i.push(u),r())}):r()}}),this},t.updateDimensions=function(){return this.each(function(){var n,i=e(this),t=i.attr("src");t&&((n=new Image).src=t,e(n).on("load.dense",function(){i.attr({width:n.width,height:n.height}).trigger("denseDimensionChanged.dense")}))})},t.devicePixelRatio=function(){var n=1;return"undefined"!==e.type(window.devicePixelRatio)?n=window.devicePixelRatio:"undefined"!==e.type(window.matchMedia)&&e.each([1.3,2,3,4,5,6],function(e,i){var t=["(-webkit-min-device-pixel-ratio: "+i+")","(min-resolution: "+Math.floor(96*i)+"dpi)","(min-resolution: "+i+"dppx)"].join(",");if(!window.matchMedia(t).matches)return!1;n=i}),Math.ceil(n)},t.getImageAttribute=function(){for(var i,t=e(this).eq(0),a=!1,d=1;d<=n;d++)(i=t.attr("data-"+d+"x"))&&(a=i);return a},n=t.devicePixelRatio(),e.fn.dense=function(n,i){return"string"===e.type(n)&&"function"===e.type(t[n])||(i=n,n="init"),t[n].call(this,i)},e(function(){e("body.dense-retina img").dense()})});